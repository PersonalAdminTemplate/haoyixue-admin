(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-314e840c"],{"0dcf":function(e,t,a){},"3d19":function(e,t,a){},"45eb":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{margin:"-24px -24px 0px"}},[a("page-header",{attrs:{breadcrumb:e.breadcrumb,title:e.title,logo:e.logo,avatar:e.avatar}},[e._t("action",null,{slot:"action"}),e._t("headerContent",null,{slot:"content"}),!this.$slots.headerContent&&e.desc?a("div",{attrs:{slot:"content"},slot:"content"},[a("p",{staticStyle:{"font-size":"14px","line-height":"1.5",color:"rgba(0,0,0,.65)"}},[e._v(" "+e._s(e.desc)+" ")]),a("div",{staticClass:"link"},[e._l(e.linkList,(function(t,r){return[a("a",{key:r,attrs:{href:t.href}},[a("a-icon",{attrs:{type:t.icon}}),e._v(e._s(t.title))],1)]}))],2)]):e._e(),e._t("extra",null,{slot:"extra"})],2),a("div",{ref:"page",class:["page-content",e.layout]},[e._t("default")],2)],1)},i=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-header"},[a("div",{class:["page-header-wide",e.layout]},[a("div",{staticClass:"breadcrumb"},[a("a-breadcrumb",e._l(e.breadcrumb,(function(t,r){return a("a-breadcrumb-item",{key:t.path},[a("span",0===r?[a("a",{attrs:{href:"#"}},[e._v(e._s(t.name))])]:[e._v(e._s(t.name))])])})),1)],1),a("div",{staticClass:"detail"},[e.avatar?a("div",{staticClass:"avatar"},[a("a-avatar",{attrs:{src:e.avatar}})],1):e._e(),a("div",{staticClass:"main"},[a("div",{staticClass:"row"},[e.logo?a("img",{staticClass:"logo",attrs:{src:e.logo}}):e._e(),e.title?a("h1",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),a("div",{staticClass:"action"},[e._t("action")],2)]),a("div",{staticClass:"row"},[this.$slots.content?a("div",{staticClass:"content"},[e._t("content")],2):e._e(),this.$slots.extra?a("div",{staticClass:"extra"},[e._t("extra")],2):e._e()])])])])])},o=[],s={name:"PageHeader",props:{title:{type:String,required:!1},breadcrumb:{type:Array,required:!1},logo:{type:String,required:!1},avatar:{type:String,required:!1}},computed:{layout:function(){return this.$store.state.setting.layout}}},l=s,c=(a("f010"),a("2877")),d=Object(c["a"])(l,n,o,!1,null,"ecb806fe",null),u=d.exports,h={name:"PageLayout",components:{PageHeader:u},props:{desc:{type:String,default:""},logo:{type:String},title:{type:String,default:""},avatar:{type:String},linkList:{type:Array},extraImage:{type:String}},data:function(){return{breadcrumb:[]}},computed:{layout:function(){return this.$store.state.setting.layout}},mounted:function(){this.getBreadcrumb()},updated:function(){this.getBreadcrumb()},methods:{getBreadcrumb:function(){this.breadcrumb=this.$route.matched}}},m=h,p=(a("d2e6"),Object(c["a"])(m,r,i,!1,null,"90fa1ce6",null));t["a"]=p.exports},"48a6":function(e,t,a){"use strict";var r=a("3d19"),i=a.n(r);i.a},"6b6f":function(e,t,a){"use strict";var r=a("0dcf"),i=a.n(r);i.a},cb4e:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("page-layout",{attrs:{desc:e.setting.desc,title:e.setting.title,linkList:e.setting.linkList,id:"user-manager"}},[a("div",{staticClass:"extraImg",attrs:{slot:"extra"},slot:"extra"},[a("img",{attrs:{src:e.setting.extraImage}})]),a("transition",{attrs:{name:"page-toggle"}},[a("keep-alive",[a("a-card",{staticClass:"content"},[a("a-form",{attrs:{form:e.searchForm.form,layout:"inline"},on:{submit:e.onSearch}},[a("a-row",{attrs:{type:"flex",align:"middle"}},[a("a-col",[a("a-spin",{attrs:{spinning:e.searchForm.isSchoolLoading}},[a("a-form-item",{staticStyle:{width:"100%"},attrs:{label:"学校"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolCode",{initialValue:e.searchForm.schoolCode,rules:[{required:!0}]}],expression:"[\n                            'schoolCode',\n                            {\n                              initialValue: searchForm.schoolCode,\n                              rules: [{ required: true }]\n                            }\n                          ]"}],attrs:{placeholder:"请选择学校",showArrow:""},on:{change:e.onSchoolChange}},e._l(e.searchForm.schoolList,(function(t,r){return a("a-select-option",{key:r,attrs:{title:t.schoolName,value:t.schoolCode}},[e._v(" "+e._s(t.schoolName)+" ")])})),1)],1)],1)],1),a("a-col",[a("a-form-item",{attrs:{label:"角色"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["role",{rules:[{required:!0}],initialValue:1}],expression:"[\n                    'role',\n                    {\n                      rules: [\n                        {\n                          required: true\n                        }\n                      ],\n                      initialValue: 1\n                    }\n                  ]"}],attrs:{name:"role"}},[a("a-radio",{attrs:{value:1}},[e._v("家长")]),a("a-radio",{attrs:{value:2}},[e._v("老师")]),a("a-radio",{attrs:{value:3}},[e._v("管理员")])],1)],1)],1),a("a-col",[a("a-form-item",{attrs:{label:"账户"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["account",{initialValue:""}],expression:"['account', { initialValue: '' }]"}],attrs:{oninput:"value=value.replace(/[^\\d]/g,'')"},on:{change:e.onAccountChange}})],1)],1),a("a-col",{staticStyle:{"flex-grow":"1"}},[a("a-form-item",[a("a-button",{attrs:{type:"primary","html-type":"submit",loading:e.searchForm.isLoading,disabled:e.searchForm.isLoading}},[e._v(" 查询 ")])],1)],1)],1)],1),a("a-table",{staticClass:"table",attrs:{pagination:e.table.pagination,columns:e.table.columns,dataSource:e.table.list,rowKey:"userId",bordered:"",loading:e.table.isLoading},on:{change:e.onPageChange},scopedSlots:e._u([e._l(["id","schoolCode","billName","description","role","createTime","updateTime"],(function(t){return{key:t,fn:function(r,i){return[a("div",{key:t},["role"===t?[1===i.role?[e._v(" 家长 ")]:e._e(),2===i.role?[e._v(" 老师 ")]:e._e(),3===i.role?[e._v(" 管理员 ")]:e._e()]:[e._v(e._s(r))]],2)]}}})),{key:"operation",fn:function(t,r){return[a("div",{staticClass:"editable-row-operations"},[a("span",[a("a",{on:{click:function(){return e.onEdit(r.userId)}}},[e._v("修改")])]),a("span",{staticStyle:{"margin-left":"12px"}},[a("a",{on:{click:function(){return e.onBind(r)}}},[e._v("绑定班级")])])])]}}],null,!0)})],1)],1)],1),a("a-modal",{staticClass:"change-modal",attrs:{visible:e.editForm.isVisible,title:"修改用户信息",okText:"确定",cancelText:"取消",okButtonProps:{props:{loading:e.editForm.isLoading}}},on:{cancel:e.cancelEdit,ok:e.saveEdit}},[a("a-form",{attrs:{layout:"vertical",form:e.editForm.form}},[a("a-col",[a("a-form-item",{attrs:{wrapperCol:{span:12},label:"学校"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["orgno",{initialValue:e.searchForm.schoolCode,rules:[{required:!0}]}],expression:"[\n                      'orgno',\n                      {\n                        initialValue: searchForm.schoolCode,\n                        rules: [{ required: true }]\n                      }\n                    ]"}],attrs:{placeholder:"请选择学校",showArrow:""}},e._l(e.searchForm.schoolList,(function(t,r){return a("a-select-option",{key:r,attrs:{title:t.schoolName,value:t.schoolCode}},[e._v(" "+e._s(t.schoolName)+" ")])})),1)],1)],1),a("a-col",[a("a-form-item",{attrs:{label:"角色"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["role",{rules:[{required:!0}],initialValue:e.editForm.data.role}],expression:"[\n                    'role',\n                    {\n                      rules: [\n                        {\n                          required: true\n                        }\n                      ],\n                      initialValue: editForm.data.role\n                    }\n                  ]"}],attrs:{name:"role"}},[a("a-radio",{attrs:{value:1}},[e._v("家长")]),a("a-radio",{attrs:{value:2}},[e._v("老师")]),a("a-radio",{attrs:{value:3}},[e._v("管理员")])],1)],1)],1),a("a-col",[a("a-form-item",{attrs:{label:"手机号码",wrapperCol:{span:12}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone",{rules:[{required:!0,message:"请输入手机号码"}],initialValue:e.editForm.data.phone}],expression:"['phone', {\n                      rules: [\n                        {\n                          required: true,\n                          message: '请输入手机号码'\n                        },\n                      ], initialValue: editForm.data.phone }]"}],attrs:{oninput:"value=value.replace(/[^\\d]/g,'')"}})],1)],1)],1)],1),a("a-modal",{attrs:{visible:e.bindForm.isVisible,title:"修改班级信息",okText:"确定",cancelText:"取消",okButtonProps:{props:{loading:e.bindForm.isLoading}}},on:{cancel:function(t){e.bindForm.isVisible=!1},ok:e.saveBind}},[a("a-card",{staticStyle:{width:"100%"},attrs:{hoverable:""}},[a("a-card-meta",{attrs:{title:e.bindForm.data.nickName||"###"}},[a("a-avatar",{attrs:{slot:"avatar",src:e.bindForm.data.headPic},slot:"avatar"}),a("template",{slot:"description"},[a("h4",[a("span",{staticStyle:{"font-weight":"800","margin-right":"8px"}},[e._v("学校名称:")]),e._v(" "+e._s(e.bindForm.data.orgName||"#####"))]),a("h4",[a("span",{staticStyle:{"font-weight":"800","margin-right":"8px"}},[e._v("手机号码:")]),e._v(" "+e._s(e.bindForm.data.phone||"################"))]),a("h4",[a("span",{staticStyle:{"font-weight":"800","margin-right":"8px"}},[e._v("角色:")]),e._v(" "+e._s(e.bindForm.data.roleName||"###"))])])],2)],1),a("a-form",{staticStyle:{"margin-top":"20px"},attrs:{layout:"vertical",form:e.bindForm.form}},[a("a-form-item",{staticStyle:{width:"100%"},attrs:{label:"班级:"}},[a("a-checkbox-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["clazz",{initialValue:e.bindForm.clazzList}],expression:"['clazz',{initialValue: bindForm.clazzList}]"}],staticClass:"overlay"},e._l(e.bindForm.departmentList,(function(t,r){return a("a-checkbox",{key:r,attrs:{value:t.depart_name}},[e._v(" "+e._s(t.depart_name)+" ")])})),1)],1)],1)],1)],1)},i=[],n=(a("4de4"),a("4160"),a("c975"),a("b64b"),a("d3b7"),a("159b"),a("284c")),o=(a("96cf"),a("45eb")),s=["家长","老师","管理员"];function l(e,t){return e instanceof Array&&t instanceof Array?e.filter((function(e){return-1===t.indexOf(e)})):(console.error("参数不是数组！"),!1)}var c={name:"QueryList",components:{PageLayout:o["a"]},data:function(){return{setting:{title:"",desc:"",linkList:[],extraImage:""},searchForm:{form:this.$form.createForm(this,{name:"form"}),isLoading:!1,schoolList:[],schoolCode:"",account:"",isSchoolLoading:!1},editForm:{form:this.$form.createForm(this,{name:"changeForm"}),isLoading:!1,isVisible:!1,data:{}},bindForm:{form:this.$form.createForm(this,{name:"bindFrom"}),isLoading:!1,isVisible:!1,data:{},departmentList:[],clazzList:[]},table:{isLoading:!1,list:[],cacheList:[],pagination:{total:0,current:1,pageSize:10},columns:[{title:"ID",dataIndex:"userId",scopedSlots:{customRender:"userId"},align:"center"},{title:"昵称",dataIndex:"nickName",scopedSlots:{customRender:"nickName"},align:"center"},{title:"学校编码",dataIndex:"orgno",scopedSlots:{customRender:"orgno"},align:"center"},{title:"手机号码",dataIndex:"phone",scopedSlots:{customRender:"phone"},align:"center"},{title:"角色",dataIndex:"role",scopedSlots:{customRender:"role"},align:"center"},{title:"创建时间",dataIndex:"createTime",scopedSlots:{customRender:"createTime"},align:"center"},{title:"更新时间",dataIndex:"lastUpdateTime",scopedSlots:{customRender:"lastUpdateTime"},align:"center"},{title:"登录时间",dataIndex:"lastLoginTime",scopedSlots:{customRender:"lastLoginTime"},align:"center"},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},align:"center"}]}}},methods:{onSearch:function(e){var t;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:if(e.preventDefault(),this.searchForm.isLoading=!0,this.table.pagination.current=1,!(null===(t=this.searchForm.account)||void 0===t?void 0:t.length)){a.next=8;break}return a.next=6,regeneratorRuntime.awrap(this.findUser());case 6:a.next=10;break;case 8:return a.next=10,regeneratorRuntime.awrap(this.getUsers());case 10:this.getSchoolDeparts(),this.searchForm.isLoading=!1;case 12:case"end":return a.stop()}}),null,this)},onSchoolChange:function(e){this.searchForm.schoolCode=e},onAccountChange:function(e){var t=e.target.value;this.searchForm.account=t},onEdit:function(e){var t=Object(n["a"])(this.table.list),a=t.filter((function(t){return e===t.userId}))[0];a&&(this.editForm.data=a),this.editForm.form.resetFields(),this.editForm.isVisible=!0},saveEdit:function(){var e;return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this.updateUserInfo());case 2:e=t.sent,e&&(this.table.cacheList=[],this.table.pagination.current=1),this.getUsers();case 5:case"end":return t.stop()}}),null,this)},cancelEdit:function(){this.editForm.data={},this.editForm.isVisible=!1},onBind:function(e){e.orgName=this.searchForm.schoolList.filter((function(t){return t.schoolCode===e.orgno}))[0].schoolName,e.roleName=s[e.role-1],this.bindForm.data=e,this.getTeacherClazzList(),this.bindForm.isVisible=!0},saveBind:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return this.bindForm.isLoading=!0,e.next=3,regeneratorRuntime.awrap(this.updateClazzList());case 3:this.bindForm.isLoading=!1;case 4:case"end":return e.stop()}}),null,this)},onPageChange:function(e){this.table.pagination.current=e.current,this.getUsers()},updateClazzList:function(){var e,t,a,r,i=this;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return e=this.bindForm.clazzList,t=[],this.bindForm.form.validateFields((function(e,a){t=a.clazz})),a=l(e,t),r=l(t,e),n.next=7,regeneratorRuntime.awrap(this.$api.addClassRelationV3({userId:this.bindForm.data.userId,classList:r}).then((function(e){})));case 7:return n.next=9,regeneratorRuntime.awrap(this.$api.deleteClassRelationV2({userId:this.bindForm.data.userId,classList:a}).then((function(e){1===e.code&&(i.$message.success("修改成功"),i.bindForm.isVisible=!1,i.table.cacheList=[],i.getUsers())})));case 9:case"end":return n.stop()}}),null,this)},updateUserInfo:function(){var e,t,a,r=this;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:if(this.editForm.isLoading=!0,this.editForm.form.validateFields((function(a,i){t=a,e={userId:r.editForm.data.userId,phone:i.phone,role:i.role,orgno:i.orgno}})),!t){i.next=6;break}this.editForm.isLoading=!1,i.next=11;break;case 6:return i.next=8,regeneratorRuntime.awrap(this.$api.updateUserInfo(e).then((function(e){1===e.code&&(r.$message.success("修改成功"),a=!0)})));case 8:this.editForm.data={},this.editForm.isLoading=!1,this.editForm.isVisible=!1;case 11:return i.abrupt("return",a);case 12:case"end":return i.stop()}}),null,this)},getUsers:function(){var e,t,a,r,i,n=this;return regeneratorRuntime.async((function(o){while(1)switch(o.prev=o.next){case 0:if(this.table.isLoading=!0,this.table.list=[],e={pageSize:this.table.pagination.pageSize,pageNum:this.table.pagination.current},t=!1,this.searchForm.form.validateFields((function(t,r){a=t,e.orgno=r.schoolCode,e.role=r.role})),a){o.next=15;break}if(r=this.table.cacheList.filter((function(t){return t.pageNum===e.pageNum&&t.role===e.role&&t.orgno===e.orgno})),!(r.length>0)){o.next=12;break}this.table.list=r[0].list,this.table.pagination.total=r[0].total,o.next=15;break;case 12:return i={pageNum:e.pageNum,role:e.role,orgno:e.orgno},o.next=15,regeneratorRuntime.awrap(this.$api.getUsers(e).then((function(e){if(1===e.code&&e.data){var a,r,o;t=!0;var s=(null===e||void 0===e?void 0:null===(a=e.data)||void 0===a?void 0:a.pageData)||[];s.forEach((function(e,t){e.children&&delete e.children,e.key=t})),n.table.list=s,n.table.pagination.total=(null===e||void 0===e?void 0:null===(r=e.data)||void 0===r?void 0:r.dataTotal)||1,i.list=s,i.total=(null===e||void 0===e?void 0:null===(o=e.data)||void 0===o?void 0:o.dataTotal)||1,n.table.cacheList.push(i)}})));case 15:return this.table.isLoading=!1,o.abrupt("return",t);case 17:case"end":return o.stop()}}),null,this)},findUser:function(){var e,t=this;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:return this.table.isLoading=!0,this.table.list=[],e={account:this.searchForm.account},a.next=5,regeneratorRuntime.awrap(this.$api.findUser(e).then((function(e){if(1===e.code){var a=(null===e||void 0===e?void 0:e.data)||{};Object.keys(a).length>0&&((null===a||void 0===a?void 0:a.children)&&delete a.children,a&&t.table.list.push(a),t.searchForm.schoolCode=a.orgno,t.searchForm.form.resetFields(["schoolCode"])),t.table.pagination.total=1}})));case 5:this.table.isLoading=!1;case 6:case"end":return a.stop()}}),null,this)},findSchoolList:function(){var e=this;return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return this.searchForm.isSchoolLoading=!0,t.next=3,regeneratorRuntime.awrap(this.$api.findSchoolList().then((function(t){var a;1===t.code&&t.data&&(e.searchForm.schoolList=t.data,e.searchForm.schoolCode=(null===t||void 0===t?void 0:null===(a=t.data[0])||void 0===a?void 0:a.schoolCode)||"")})));case 3:this.searchForm.isSchoolLoading=!1;case 4:case"end":return t.stop()}}),null,this)},getTeacherClazzList:function(){var e,t=this;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:return this.bindForm.isSchoolLoading=!0,e={userId:this.bindForm.data.userId},a.next=4,regeneratorRuntime.awrap(this.$api.getTeacherClazzList(e).then((function(e){1===e.code&&e.data&&(t.bindForm.clazzList=e.data,t.bindForm.form.resetFields(["clazz"]))})));case 4:this.bindForm.isSchoolLoading=!1;case 5:case"end":return a.stop()}}),null,this)},getSchoolDeparts:function(){var e,t=this;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:return e={},this.searchForm.form.validateFields((function(t,a){e.schoolCode=a.schoolCode})),a.next=4,regeneratorRuntime.awrap(this.$api.getSchoolDeparts(e).then((function(e){1===e.code&&e.data&&(t.bindForm.departmentList=e.data)})));case 4:this.bindForm.form.setFieldsValue({depart_name:"全部"});case 5:case"end":return a.stop()}}),null,this)},initData:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this.findSchoolList());case 2:this.getUsers(),this.getSchoolDeparts();case 4:case"end":return e.stop()}}),null,this)}},activated:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return this.$npStart(),e.next=3,regeneratorRuntime.awrap(this.initData());case 3:this.$npDone();case 4:case"end":return e.stop()}}),null,this)}},d=c,u=(a("48a6"),a("6b6f"),a("2877")),h=Object(u["a"])(d,r,i,!1,null,"2a7aa7fc",null);t["default"]=h.exports},d2e6:function(e,t,a){"use strict";var r=a("e675"),i=a.n(r);i.a},e181:function(e,t,a){},e675:function(e,t,a){},f010:function(e,t,a){"use strict";var r=a("e181"),i=a.n(r);i.a}}]);
//# sourceMappingURL=chunk-314e840c.da613a29.js.map